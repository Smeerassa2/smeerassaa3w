from flask import Flask
import subprocess
import tkinter as tk
from tkinter import messagebox
import os

# كود Flask لتشغيل التطبيق
app = Flask(__name__)

@app.route('/run-app')
def run_app():
    subprocess.Popen(["python", __file__])  # تشغيل هذا الملف نفسه
    return "تم تشغيل التطبيق بنجاح!"

if __name__ == '__main__':
    # التحقق إذا كان يتم تشغيل Flask أو واجهة المستخدم
    import sys
    if len(sys.argv) > 1 and sys.argv[1] == 'flask':
        app.run(debug=True, port=5000)
    else:
        # كود واجهة المستخدم الرسومية
        root = tk.Tk()
        root.title("واجهة المستخدم")
        root.geometry("400x500")
        root.configure(bg="#2e2e2e")

        title_label = tk.Label(root, text="واجهة المستخدم", font=("Arial", 30, "bold"), fg="white", bg="#2e2e2e")
        title_label.pack(pady=30)

        email_label = tk.Label(root, text="البريد الإلكتروني:", font=("Arial", 14), fg="white", bg="#2e2e2e")
        email_label.pack(pady=(10, 5))
        email_entry = tk.Entry(root, width=30)
        email_entry.pack(pady=5)

        password_label = tk.Label(root, text="كلمة المرور:", font=("Arial", 14), fg="white", bg="#2e2e2e")
        password_label.pack(pady=(10, 5))
        password_entry = tk.Entry(root, width=30, show="*")
        password_entry.pack(pady=5)

        def login():
            email = email_entry.get()
            password = password_entry.get()

            if not os.path.exists("users.txt"):
                messagebox.showerror("خطأ", "لم يتم العثور على بيانات المستخدم. يرجى إنشاء حساب جديد.")
                return

            with open("users.txt", "r") as file:
                users = file.readlines()
                for user in users:
                    saved_email, saved_password = user.strip().split(",")
                    if email == saved_email and password == saved_password:
                        messagebox.showinfo("نجاح", "تم تسجيل الدخول بنجاح!")
                        return
            messagebox.showerror("خطأ", "البريد الإلكتروني أو كلمة المرور غير صحيحة")

        def signup():
            email = email_entry.get()
            password = password_entry.get()
            if email and password:
                with open("users.txt", "a") as file:
                    file.write(f"{email},{password}\n")
                messagebox.showinfo("نجاح", "تم إنشاء حساب جديد بنجاح!")
            else:
                messagebox.showerror("خطأ", "يرجى إدخال البريد الإلكتروني وكلمة المرور")

        login_button = tk.Button(root, text="تسجيل الدخول", command=login, width=20, height=2, bg="#4CAF50", fg="white")
        login_button.pack(pady=10)

        signup_button = tk.Button(root, text="إنشاء حساب جديد", command=signup, width=20, height=2, bg="#2196F3", fg="white")
        signup_button.pack(pady=10)

        root.mainloop()
